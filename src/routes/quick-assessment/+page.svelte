<script lang="ts">
	import Button from "$lib/components/ui/button.svelte";
	import Card from "$lib/components/ui/card.svelte";
	import Hero from '$lib/components/Hero.svelte';
	import { onMount } from 'svelte';

	// Current step in the assessment journey
	let currentStep = $state(1);
	let isBookingComplete = $state(false);
	let showBookingModal = $state(false);
	let calEmbed: HTMLElement;

	// Cal.com configuration
	const calUsername = "alphabits"; // Replace with your actual Cal.com username
	const eventSlug = "mini"; // Replace with your actual event slug

	function handleBookingSuccess() {
		console.log("Booking created successfully");
		isBookingComplete = true;
		showBookingModal = false;
		// You can add additional success handling here
	}

	function nextStep() {
		currentStep++;
	}

	function prevStep() {
		if (currentStep > 1) currentStep--;
	}

	function openBookingModal() {
		showBookingModal = true;
		// Initialize Cal.com embed when modal opens
		setTimeout(() => {
			if (typeof window !== 'undefined' && calEmbed) {
				try {
					// Load Cal.com embed script if not already loaded
					if (!(window as any).Cal) {
						const script = document.createElement('script');
						script.src = 'https://app.cal.com/embed/embed.js';
						script.async = true;
						document.head.appendChild(script);
						
						script.onload = () => {
							initializeCal();
						};
					} else {
						initializeCal();
					}
				} catch (error) {
					console.warn('Cal.com embed not available:', error);
				}
			}
		}, 100);
	}

	function initializeCal() {
		const cal = (window as any).Cal;
		if (cal) {
			cal('init', {
				origin: 'https://cal.com'
			});
			
			// Listen for booking success
			cal('on', {
				action: 'bookingSuccessful',
				callback: handleBookingSuccess
			});
		}
	}

	function closeBookingModal() {
		showBookingModal = false;
	}
</script>

<svelte:head>
	<title>Quick Assessment - AI Workflow Automation | Alphabits</title>
	<meta name="description" content="Start your AI automation journey with a quick 30-minute assessment. Book your consultation to discover how AI can transform your business processes." />
</svelte:head>

<Hero 
	title="Start Your AI Journey" 
	subtitle="Every transformation begins with understanding. Let's explore how AI can revolutionize your business processes in just 30 minutes."
	variant="default"
/>

<div class="min-h-screen bg-gradient-to-br from-blue-50 via-white to-purple-50">
	<div class="container mx-auto px-4 py-8 sm:py-12 lg:py-16">

		<!-- Progress Steps -->
		<div class="flex justify-center mb-8 sm:mb-12 px-4">
			<div class="flex items-center space-x-2 sm:space-x-4 max-w-full overflow-x-auto">
				<div class="flex items-center flex-shrink-0">
					<div class="w-8 h-8 sm:w-10 sm:h-10 rounded-full {currentStep >= 1 ? 'bg-blue-600 text-white' : 'bg-gray-200 text-gray-600'} flex items-center justify-center text-sm font-medium">
						1
					</div>
					<span class="ml-2 text-xs sm:text-sm font-medium text-gray-700 hidden sm:inline">Discovery</span>
					<span class="ml-1 text-xs font-medium text-gray-700 sm:hidden">Discovery</span>
				</div>
				<div class="w-8 sm:w-16 h-0.5 {currentStep >= 2 ? 'bg-blue-600' : 'bg-gray-200'} flex-shrink-0"></div>
				<div class="flex items-center flex-shrink-0">
					<div class="w-8 h-8 sm:w-10 sm:h-10 rounded-full {currentStep >= 2 ? 'bg-blue-600 text-white' : 'bg-gray-200 text-gray-600'} flex items-center justify-center text-sm font-medium">
						2
					</div>
					<span class="ml-2 text-xs sm:text-sm font-medium text-gray-700 hidden sm:inline">Assessment</span>
					<span class="ml-1 text-xs font-medium text-gray-700 sm:hidden">Assessment</span>
				</div>
				<div class="w-8 sm:w-16 h-0.5 {currentStep >= 3 ? 'bg-blue-600' : 'bg-gray-200'} flex-shrink-0"></div>
				<div class="flex items-center flex-shrink-0">
					<div class="w-8 h-8 sm:w-10 sm:h-10 rounded-full {currentStep >= 3 ? 'bg-blue-600 text-white' : 'bg-gray-200 text-gray-600'} flex items-center justify-center text-sm font-medium">
						3
					</div>
					<span class="ml-2 text-xs sm:text-sm font-medium text-gray-700 hidden sm:inline">Transformation</span>
					<span class="ml-1 text-xs font-medium text-gray-700 sm:hidden">Transform</span>
				</div>
			</div>
		</div>

		<!-- Content based on current step -->
		{#if currentStep === 1}
			<!-- Step 1: Discovery -->
			<div class="max-w-4xl mx-auto">
				<Card class="p-8 mb-8">
				<div class="text-center mb-6">
					<h2 class="text-2xl font-bold text-gray-900 mb-4">
						üîç Discovery Phase
					</h2>
					<p class="text-lg text-gray-600">
						Before we dive into solutions, let's understand your current challenges and opportunities.
					</p>
				</div>
				<div class="mb-6">
						<div class="grid md:grid-cols-2 gap-8">
							<div class="space-y-6">
								<h3 class="text-xl font-semibold text-gray-900">What We'll Explore</h3>
								<ul class="space-y-3">
									<li class="flex items-start space-x-3">
										<span class="text-blue-600">‚Ä¢</span>
										<span>Current business processes and pain points</span>
									</li>
									<li class="flex items-start space-x-3">
										<span class="text-blue-600">‚Ä¢</span>
										<span>Time-consuming manual tasks</span>
									</li>
									<li class="flex items-start space-x-3">
										<span class="text-blue-600">‚Ä¢</span>
										<span>Data management challenges</span>
									</li>
									<li class="flex items-start space-x-3">
										<span class="text-blue-600">‚Ä¢</span>
										<span>Growth bottlenecks and scalability issues</span>
									</li>
								</ul>
							</div>
							<div class="bg-blue-50 p-6 rounded-lg">
								<h4 class="font-semibold text-blue-900 mb-3">Why This Matters</h4>
								<p class="text-blue-800 text-sm leading-relaxed">
									Understanding your unique situation allows us to identify the most impactful AI solutions. This isn't about technology for technology's sake‚Äîit's about finding the right tools to solve your specific challenges and unlock new opportunities.
								</p>
							</div>
						</div>
					</div>
				<div class="flex justify-center">
					<Button onclick={nextStep} class="px-8 py-3">
						Continue to Assessment
					</Button>
				</div>
			</Card>
			</div>

		{:else if currentStep === 2}
			<!-- Step 2: Assessment & Booking -->
			<div class="max-w-4xl mx-auto">
				<Card class="p-6 lg:p-8">
				<div class="text-center mb-8">
					<h2 class="text-2xl font-bold text-gray-900 mb-4">
						üìÖ Schedule Your Assessment
					</h2>
					<p class="text-lg text-gray-600 mb-6">
						Book a 30-minute consultation with our AI experts to discuss your specific needs and opportunities.
					</p>
				</div>
				
				<div class="mb-8">
					<div class="grid md:grid-cols-2 gap-8">
						<!-- Booking Call-to-Action -->
						<div class="text-center">
							<div class="bg-gradient-to-br from-blue-50 to-purple-50 rounded-lg p-8 mb-6">
								<div class="text-6xl mb-4">üìÖ</div>
								<h3 class="text-xl font-semibold text-gray-900 mb-3">Ready to Get Started?</h3>
								<p class="text-gray-600 mb-6">Click below to open our booking calendar and select your preferred time slot.</p>
								<Button onclick={openBookingModal} class="px-8 py-3 text-lg">
									üìÖ Open Booking Calendar
								</Button>
							</div>
							
							{#if isBookingComplete}
								<div class="bg-green-50 border border-green-200 rounded-lg p-4">
									<div class="flex items-center justify-center space-x-2 mb-2">
										<span class="text-green-600 text-xl">‚úÖ</span>
										<p class="font-semibold text-green-800">Booking Confirmed!</p>
									</div>
									<p class="text-sm text-green-700">Check your email for confirmation details</p>
								</div>
							{/if}
						</div>

						<!-- Assessment Details -->
						<div>
							<div class="bg-white rounded-lg border p-6">
								<h3 class="text-lg font-semibold mb-4 text-gray-900">Assessment Details</h3>
								<div class="space-y-4">
									<div class="flex items-start space-x-3">
										<div class="w-8 h-8 bg-blue-100 rounded-full flex items-center justify-center flex-shrink-0">
											<span class="text-blue-600 text-sm">‚è±Ô∏è</span>
										</div>
										<div>
											<p class="text-sm font-medium text-gray-900">Duration</p>
											<p class="text-sm text-gray-600">30 minutes</p>
										</div>
									</div>
									
									<div class="flex items-start space-x-3">
										<div class="w-8 h-8 bg-green-100 rounded-full flex items-center justify-center flex-shrink-0">
											<span class="text-green-600 text-sm">üíª</span>
										</div>
										<div>
											<p class="text-sm font-medium text-gray-900">Format</p>
											<p class="text-sm text-gray-600">Video Call</p>
										</div>
									</div>
									
									<div class="flex items-start space-x-3">
										<div class="w-8 h-8 bg-purple-100 rounded-full flex items-center justify-center flex-shrink-0">
											<span class="text-purple-600 text-sm">üí∞</span>
										</div>
										<div>
											<p class="text-sm font-medium text-gray-900">Cost</p>
											<p class="text-sm font-semibold text-green-600">Free Consultation</p>
										</div>
									</div>
									
									<div class="mt-6 p-4 bg-gray-50 rounded-lg">
										<h4 class="text-sm font-semibold text-gray-900 mb-2">What to Expect</h4>
										<ul class="text-xs text-gray-600 space-y-1">
											<li>‚Ä¢ Process analysis & pain point identification</li>
											<li>‚Ä¢ AI opportunity assessment</li>
											<li>‚Ä¢ Custom roadmap recommendations</li>
											<li>‚Ä¢ Next steps discussion</li>
										</ul>
									</div>
								</div>
							</div>
						</div>
					</div>
				</div>
				
				<div class="flex flex-col sm:flex-row justify-between gap-4 pt-4 border-t">
					<Button variant="outline" onclick={prevStep} class="w-full sm:w-auto">
						‚Üê Back to Discovery
					</Button>
					<Button onclick={nextStep} class="w-full sm:w-auto px-6">
						Next: Transformation ‚Üí
					</Button>
				</div>
			</Card>
			</div>

		{:else if currentStep === 3}
			<!-- Step 3: Transformation -->
			<div class="max-w-4xl mx-auto">
				<Card class="p-8">
				<div class="text-center mb-6">
					<h2 class="text-2xl font-bold text-gray-900 mb-4">
						üöÄ Your Transformation Journey
					</h2>
					<p class="text-lg text-gray-600">
						After your assessment, here's what happens next in your AI automation journey.
					</p>
				</div>
				<div class="mb-6">
						<div class="space-y-8">
							<div class="grid md:grid-cols-3 gap-6">
								<div class="text-center p-6 bg-blue-50 rounded-lg">
									<div class="w-12 h-12 bg-blue-600 text-white rounded-full flex items-center justify-center mx-auto mb-4 text-xl">
										üìã
									</div>
									<h3 class="font-semibold text-gray-900 mb-2">Custom Strategy</h3>
									<p class="text-sm text-gray-600">Receive a tailored AI implementation roadmap based on your specific needs and goals.</p>
								</div>
								<div class="text-center p-6 bg-green-50 rounded-lg">
									<div class="w-12 h-12 bg-green-600 text-white rounded-full flex items-center justify-center mx-auto mb-4 text-xl">
										‚ö°
									</div>
									<h3 class="font-semibold text-gray-900 mb-2">Quick Wins</h3>
									<p class="text-sm text-gray-600">Identify immediate automation opportunities that can deliver results within weeks.</p>
								</div>
								<div class="text-center p-6 bg-purple-50 rounded-lg">
									<div class="w-12 h-12 bg-purple-600 text-white rounded-full flex items-center justify-center mx-auto mb-4 text-xl">
										üéØ
									</div>
									<h3 class="font-semibold text-gray-900 mb-2">Long-term Vision</h3>
									<p class="text-sm text-gray-600">Develop a comprehensive plan for scaling AI across your entire organization.</p>
								</div>
							</div>
						</div>
					</div>
				<div class="flex justify-center">
					<Button onclick={prevStep} variant="outline">
						Back to Booking
					</Button>
				</div>
			</Card>
			</div>
		{/if}
	</div>
</div>

<!-- Booking Modal -->
{#if showBookingModal}
	<div class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4">
		<div class="bg-white rounded-lg shadow-xl max-w-4xl w-full max-h-[90vh] overflow-hidden">
			<!-- Modal Header -->
			<div class="flex items-center justify-between p-6 border-b">
				<div>
					<h3 class="text-xl font-semibold text-gray-900">Book Your AI Assessment</h3>
					<p class="text-sm text-gray-600 mt-1">Select your preferred time slot</p>
				</div>
				<button 
					onclick={closeBookingModal}
					class="text-gray-400 hover:text-gray-600 transition-colors"
				>
					<svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
						<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
					</svg>
				</button>
			</div>
			
			<!-- Modal Content -->
			<div class="p-6 overflow-y-auto max-h-[calc(90vh-120px)]">
				<div class="relative min-h-[600px]">
					<!-- Cal.com Embed Container -->
					<div 
						bind:this={calEmbed}
						data-cal-link="{calUsername}/{eventSlug}"
						data-cal-config='{JSON.stringify({layout:"month_view",theme:"light"})}'
						class="w-full h-full"
						style="width:100%;height:100%;overflow:scroll"
					></div>
					
					<!-- Loading fallback -->
					<div class="absolute inset-0 flex items-center justify-center bg-gray-50 border-2 border-dashed border-gray-300 rounded-lg">
						<div class="text-center p-6">
							<div class="text-4xl mb-4">üìÖ</div>
							<h4 class="text-lg font-semibold text-gray-900 mb-2">Loading Calendar...</h4>
							<p class="text-gray-600">Please wait while we load the booking calendar</p>
						</div>
					</div>
				</div>
			</div>
		</div>
	</div>
{/if}

<style>
	.no-scrollbar {
		-ms-overflow-style: none;
		scrollbar-width: none;
	}
	.no-scrollbar::-webkit-scrollbar {
		display: none;
	}
</style>